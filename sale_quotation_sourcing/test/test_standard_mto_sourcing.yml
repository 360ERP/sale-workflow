-
  I select for this file a user that is not admin
-
  !context
  uid: 'res_users_fiona'
-
  I create a quotation that is not manually sourced
-
  !record {model: sale.order, id: so_1}:
    partner_id: base.res_partner_2
    payment_term: account.account_payment_term
    order_line:
      - product_id: product.product_product_7
        product_uom_qty: 8
-
  I confirm the sale order
-
  !python {model: sale.order}: |
    from nose.tools import *

    retval = self.action_button_confirm(cr, uid, ref('so_1'), context=context)
    assert_is(retval, True)
    
    so = model.browse(cr, uid, ref('so_1'))
    assert_not_equal(so.state, u'draft')

    self.pool['procurement.order'].run_scheduler(cr, uid)

    line_procurements = so.order_line[0].procurement_ids

    assert_equals(len(line_procurements), 1)

    proc1 = line_procurements[0]

    assert_false(proc1.purchase_line_id)
