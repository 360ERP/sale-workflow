-
  Feature. Manual sourcing of a dropshipping sale
    Scenario. Check consistency between a dropshipping sale and a purchase with destination Stock
-
  Background. I log in as Fiona
-
  !context
  uid: 'res_users_fiona'
-
  Given I have a Sale with dropshipping route
-
  !record {model: sale.order, id: so_5}:
    partner_id: base.res_partner_3
    order_line:
      - product_id: product.product_product_7
        product_uom_qty: 8
        manually_sourced: 1
        route_id: route_drop_shipping
-
  But I source it with a purchase with destination Stock
-
  !record {model: purchase.order, id: po_5}:
    partner_id: base.res_partner_6
    order_line:
      - product_id: product.product_product_7
        product_qty: 8
-
  !python {model: sale.order, id: so_5}: |
    po = self.env['purchase.order'].browse(ref('po_5'))
    self.order_line[0].sourced_by = po.order_line[0]
-
  When I confirm the sale
  Then I should be blocked
-
  !python {model: sale.order, id: so_5}: |
    from nose.tools import *
    from openerp.exceptions import Warning
    with assert_raises(Warning):
        self.action_button_confirm()
